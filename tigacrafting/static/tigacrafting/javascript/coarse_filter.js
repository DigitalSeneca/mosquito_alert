$(document).ready(function() {

const data = {"count":8821,"next":2,"previous":null,"results":[{"photos":[{"id":154303,"photo":"/media/tigapics/7848ce6d-0874-4dc4-be2f-fd637494b9ff.jpg","uuid":"d9c2d146-a489-4c3f-b9d2-9b6b9ad22ef4"},{"id":154304,"photo":"/media/tigapics/6ed06d90-8596-4a50-a347-59c087bcd29a.jpg","uuid":"a214b0b2-94de-4e54-80c9-829aced6eb37"}],"version_UUID":"36cd0b55-99ad-4356-9b61-8a190cee7239","report_id":"5JU4","creation_time":"2024-05-21T23:33:11.401459Z","type":"adult","note":null,"point":"SRID=4326;POINT (22.9795635 40.6184705)","country":{"gid":16,"name_engl":"Greece"}},{"photos":[{"id":154300,"photo":"/media/tigapics/a3d3536a-add6-4f84-adb6-45de0f788d4b.jpg","uuid":"a118e915-362a-45e7-9150-f9e528dae1a9"},{"id":154301,"photo":"/media/tigapics/fada5b23-0a40-4782-b6bd-534480a876b3.jpg","uuid":"a01e3635-a84e-412b-b464-2292ca792acd"},{"id":154302,"photo":"/media/tigapics/117a74b5-92de-4ee8-9523-23a02650e0b2.jpg","uuid":"6c42432e-f77a-4da2-8c9c-614c6fd6e4f5"}],"version_UUID":"d4c7f553-20c9-4e9b-bfc5-06b6edb41a14","report_id":"CCAJ","creation_time":"2024-05-21T23:32:30.648794Z","type":"adult","note":null,"point":"SRID=4326;POINT (22.9795668 40.6184682)","country":{"gid":16,"name_engl":"Greece"}},{"photos":[{"id":154299,"photo":"/media/tigapics/21f7ae9c-d9dc-454f-8d8f-a7e5d45f2f00.jpg","uuid":"8f81e9fd-6945-40ed-b2fd-0b409d9f268f"}],"version_UUID":"4901c19e-8e53-43ce-85b2-039f570b1154","report_id":"3304","creation_time":"2024-05-21T23:31:55.622539Z","type":"adult","note":null,"point":"SRID=4326;POINT (22.979579 40.6184617)","country":{"gid":16,"name_engl":"Greece"}},{"photos":[{"id":154297,"photo":"/media/tigapics/331fcf07-8671-49b5-89bf-3b0b15717ccf.jpg","uuid":"c886a0c4-8a6a-44c0-96c6-613ddf7afad2"},{"id":154298,"photo":"/media/tigapics/490568ad-dae3-4d94-8025-ca4c015bdbc8.jpg","uuid":"dc92b7a6-b7cd-49d0-bc38-060eeda6bc8b"}],"version_UUID":"1c1fa3fa-150d-43eb-8564-ec82fbbe8224","report_id":"65L2","creation_time":"2024-05-21T23:31:21.077925Z","type":"adult","note":null,"point":"SRID=4326;POINT (22.9795755 40.6185027)","country":{"gid":16,"name_engl":"Greece"}},{"photos":[{"id":154296,"photo":"/media/tigapics/d33cc877-212b-46dd-b9d9-51f2a754980c.jpg","uuid":"e26e3f4c-2d6a-4290-8dbd-34d608e754d7"}],"version_UUID":"24e64566-2ef5-496b-97ad-d3f89d0f5b98","report_id":"5C6v","creation_time":"2024-05-21T23:30:33.447754Z","type":"adult","note":null,"point":"SRID=4326;POINT (22.9795471 40.618474)","country":{"gid":16,"name_engl":"Greece"}},{"photos":[{"id":154295,"photo":"/media/tigapics/ee87aaeb-a74d-4ae5-8f59-aab68174091c.jpg","uuid":"95474311-d969-4c4d-b398-a3eaec57ebc8"}],"version_UUID":"3dc3a0b1-3b84-4b1d-8ffb-70607c957d88","report_id":"b839","creation_time":"2024-05-21T23:30:11.358382Z","type":"adult","note":null,"point":"SRID=4326;POINT (22.9795837 40.6185079)","country":{"gid":16,"name_engl":"Greece"}},{"photos":[{"id":154294,"photo":"/media/tigapics/812b0cfc-9a42-4599-ab0b-74b1ca63ecf0.jpg","uuid":"86c30f4d-aa0b-413c-a253-b736753615f2"}],"version_UUID":"03bc28bd-539f-4169-bed9-11238aac99d1","report_id":"zlfR","creation_time":"2024-05-21T22:05:12.913402Z","type":"adult","note":null,"point":"SRID=4326;POINT (12.684941 41.9011098)","country":{"gid":49,"name_engl":"Italy"}},{"photos":[{"id":154293,"photo":"/media/tigapics/10125d60-33b2-43cf-91d4-f642bfc87850.jpg","uuid":"a4cf5618-3437-46c4-97c1-c4710f48a275"}],"version_UUID":"4446c7fb-f1b4-43f2-9829-3b3c30c1d62c","report_id":"O8ka","creation_time":"2024-05-21T22:04:25.382413Z","type":"adult","note":null,"point":"SRID=4326;POINT (-5.3094608 35.8885452)","country":{"gid":17,"name_engl":"Spain"}},{"photos":[{"id":154290,"photo":"/media/tigapics/cb2b3861-dd90-4b12-8a4b-360bf75ddefc.jpg","uuid":"130ccbbf-8a44-49d4-b7b0-be2369d9b653"},{"id":154291,"photo":"/media/tigapics/d8927d0f-2779-42f9-a606-b2c80b14179a.jpg","uuid":"b974146e-9973-472b-9eeb-7a51f20a99d6"},{"id":154292,"photo":"/media/tigapics/a1aae2cf-e31f-4c1f-a3a3-d93d2b0aa048.jpg","uuid":"2f46c39f-2700-4839-9e74-b16da35c6905"}],"version_UUID":"69a29af0-2b30-40a6-b870-a878301212b5","report_id":"8mf3","creation_time":"2024-05-21T21:30:50.273880Z","type":"adult","note":"#colegiolamagdalena #proyectomosquitos","point":"SRID=4326;POINT (-0.0299565 40.000349)","country":{"gid":17,"name_engl":"Spain"}},{"photos":[{"id":154287,"photo":"/media/tigapics/9450f308-c0a2-4186-b739-b2cd5ebada8a.jpg","uuid":"7a46827f-9409-4088-931d-c03b676edad7"},{"id":154288,"photo":"/media/tigapics/e405252e-d011-457a-ada8-fb9b6b839611.jpg","uuid":"d317cf9b-d741-467d-a12d-ec920e4f0522"},{"id":154289,"photo":"/media/tigapics/f2725d3f-d9c3-49e5-ad8a-02660baf10d2.jpg","uuid":"8c1e54b6-6fee-41c0-9205-cda4b25ed4c7"}],"version_UUID":"3e7f7908-3a61-4016-8bb0-49a57423ee3f","report_id":"P4wJ","creation_time":"2024-05-21T21:29:10.444768Z","type":"adult","note":null,"point":"SRID=4326;POINT (-0.0299381 40.0003876)","country":{"gid":17,"name_engl":"Spain"}}]};

function create_ia_graph(){
    $('.ia_graph').each(function(){
        const id = $(this).attr('id');
        var type = $('#' + id).data('type');
        if(type=='adult'){
            try{
                create_graph( id );
            }catch(error){
                console.log(error);
            }
        }
    });
}

function load_data(){
    $.ajax({
        url: '/api/coarse_filter_reports/?limit=100',
        type: "GET",
        dataType: "json",
        success: function(data) {
            const root = $('#photo_grid');
            for(var i = 0; i < data.results.length; i++){
                const report = data.results[i];
                const single_report = single_report_template(report);
                root.append(single_report);
            }
            create_ia_graph();
        },
        cache: false
    });
}

function single_picture_template(picture){
    return `
        <div class="picture_item">
            <img src="${ picture.photo }">
        </div>
    `;
}

function pictures_template(pictures){
    const elements = pictures.reduce((acc, picture) => acc + single_picture_template(picture), "");
    return elements;
}

function single_report_template(report){
    const pictures = pictures_template(report.photos);
    const report_country_name = report.country == null ? 'No country' : report.country.name_engl;
    const site_cat = report.site_cat == 0 ? 'storm_drain' : 'other';
    const ia_value = report.ia_filter_1 == null ? 'N/A' : report.ia_filter_1;
    return `
        <div id="${ report.version_UUID }" class="photo ${ report.type } ${ site_cat }">
            <div class="photo_internal_wrapper">
                <div class="header_internal_wrapper">
                    <div class="header_country">
                        <a href="/single_simple/${ report.version_UUID }" target="_blank"><span class="glyphicon glyphicon-link" style="color: white;"> ${ report_country_name }</span></a>
                    </div>
                    <div class="header_ia">
                        IA Value ${ ia_value }
                        <div id="ia${ report.version_UUID }" data-ia-value="${ report.ia_filter_1 }" data-type="${ report.type }" data-id="${ report.version_UUID }" class="ia_graph ${report.type}" style=""></div>
                    </div>
                </div>
                <hr class="hrnomargin">
                <div class="body_internal_wrapper">
                    <p><span class="label label-success">Report id</span> ${ report.version_UUID }</p>
                    <p><span class="label label-success">Date</span> ${ report.creation_time }</p>
                    <p><span class="label label-success">User Notes</span> ${ report.note } </p>
                </div>
                <hr>
                <div class="pictures_internal_grid_wrapper">
                    <div class="pictures_internal_grid">
                        ${ pictures }
                    </div>
                </div>
                <hr class="hrnomargin">
                <div class="buttons_internal_grid">
                    <button type="button" class="btn btn-primary foot_btn">1</button>
                    <button type="button" class="btn btn-primary foot_btn">2</button>
                    <button type="button" class="btn btn-primary foot_btn">3</button>
                </div>
            </div>
        </div>
    `;
}

/*
function test(){
    const root = $('#photo_grid');
    for(var i = 0; i < data.results.length; i++){
        const report = data.results[i];
        const single_report = single_report_template(report);
        //console.log( single_report );
        root.append(single_report);
    }
}
test();
*/
load_data();

});